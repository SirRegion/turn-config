items:
  ComplianceBase Utilities:
    items:
      Pull a docker image:
        environment:
          MTEC_DOCKER_REGISTRY:
            persistent: "Yes"
          CB_DOCKER_CONTAINER:
            persistent: "Yes"
          CB_VARIANT:
            persistent: "Yes"
          CB_VERSION:
            persistent: "Yes"
        powershell:
          - docker pull "${Env:MTEC_DOCKER_REGISTRY}/main/${Env:CB_DOCKER_CONTAINER}/${Env:CB_VARIANT}:${Env:CB_VERSION}"
      Inspect:
        powershell:
          - echo "not implemented"
      Configure:
        powershell:
          - echo "not implemented"
      Utilities:
        items:
          Push Files to the Container:
            powershell:
              - echo "not implemented"
          Pull Files from Container:
            powershell:
              - echo "not implemented"
          Open an interactive Shell inside the Container:
            environment:
              CB_DOCKER_CONTAINER:
                persistent: "Yes"
            powershell:
              - Start-Process PowerShell -ArgumentList "docker exec -it $Env:CB_DOCKER_CONTAINER powershell; Read-Host 'Press Enter'"
          Create Data Backup:
            powershell:
              - $CB_BACKUP_PATH="/mnt/backup/cb_backend_v0_1/mysqldump_$(get-date -f yyyy-MM-dd_HHmm).sql"
              - docker exec "$Env:CB_DOCKER_CONTAINER" powershell -C "mkdir /mnt/backup/cb_backend_v0_1 -Force | Out-Null; mysqldump --user='root' --password='OwobEB7M' --databases cb_backend_v0_1 > '$CB_BACKUP_PATH'"
          Show all environment variables:
            powershell:
              - ./dump.ps1
      Run Container:
        environment:
          CB_DOCKER_PORT:
            persistent: "Yes"
          CB_DOCKER_CONTAINER:
            persistent: "Yes"
          CB_VARIANT:
            persistent: "Yes"
          CB_VERSION:
            persistent: "Yes"
          CB_DOMAIN:
            persistent: "Yes"
        powershell:
          - ./run.ps1
      Stop Container:
        environment:
          CB_DOCKER_CONTAINER:
            persistent: "Yes"
        powershell:
          - docker stop ${env:CB_DOCKER_CONTAINER}
      Remove Container:
        environment:
          CB_DOCKER_CONTAINER:
            persistent: "Yes"
        confirm: Are you sure you want to remove the container? Data might be lost!
        powershell:
          - docker rm -f ${env:CB_DOCKER_CONTAINER}